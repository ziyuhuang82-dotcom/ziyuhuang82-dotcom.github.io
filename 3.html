<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>水果電商 — 進銷存管理範例</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#16a34a;--muted:#94a3b8;--glass:rgba(255,255,255,0.04);--glass2:rgba(255,255,255,0.02);}
    *{box-sizing:border-box}
    body{margin:0;font-family: system-ui, -apple-system, "Noto Sans TC","PingFang TC", "Microsoft JhengHei", Arial; background:linear-gradient(180deg,#071023 0%, #081428 60%);color:#e6eef5;padding:24px}
    .wrap{max-width:1200px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#22c55e,#16a34a);display:flex;align-items:center;justify-content:center;font-weight:800}
    h1{margin:0;font-size:1.2rem}
    .sub{color:var(--muted);font-size:0.95rem}

    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:20px}

    /* 左 - 商品與操作 */
    .panel{background:linear-gradient(180deg,var(--card),#071226);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .panel h2{margin:0 0 8px 0}
    label{display:block;font-size:0.85rem;color:var(--muted);margin-top:8px}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#042014;cursor:pointer}
    .muted{color:var(--muted)}

    .small-btn{padding:6px 8px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer}

    /* 右 - 資料表 */
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    table{width:100%;border-collapse:collapse;font-size:0.95rem}
    th,td{padding:10px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
    th{background:transparent;color:var(--muted);font-weight:700}
    .stock-low{color:#ffb02e;font-weight:700}
    .stock-out{color:#ff6b6b;font-weight:800}

    .metrics{display:flex;gap:12px;margin-top:12px}
    .metric{background:var(--glass2);padding:10px;border-radius:10px;flex:1}

    footer{margin-top:18px;color:var(--muted);font-size:0.9rem;text-align:center}

    @media (max-width:1000px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">果</div>
        <div>
          <h1>水果電商 — 進銷存管理</h1>
          <div class="sub">單檔範例（HTML/CSS/JS）— 可儲存於 localStorage，含進貨、銷貨、庫存與交易紀錄。</div>
        </div>
      </div>
      <div>
        <button id="exportBtn" class="small-btn">匯出 CSV</button>
        <button id="importBtn" class="small-btn">匯入 CSV</button>
        <input id="fileInput" type="file" accept="text/csv" style="display:none">
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="panel">
          <h2>新增 / 編輯商品</h2>
          <input id="pId" type="hidden" />
          <label>名稱</label>
          <input id="pName" placeholder="例如：台灣青蘋果" />
          <label>單價 (NT$)</label>
          <input id="pPrice" type="number" min="0" value="100" />
          <label>庫存數量</label>
          <input id="pStock" type="number" min="0" value="0" />
          <label>備註</label>
          <input id="pNote" placeholder="產地、單位 (例如：盒、公斤)" />
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="saveProduct">儲存商品</button>
            <button id="clearForm" class="small-btn">清除</button>
            <button id="seedDemo" class="small-btn">範例資料</button>
          </div>

          <div style="margin-top:18px">
            <h3 style="margin:0 0 8px 0">進貨 / 銷貨 (快速操作)</h3>
            <label>選擇商品</label>
            <select id="tranProduct"></select>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="tranQty" type="number" min="1" value="1" style="width:100px" />
              <select id="tranType" style="width:140px">
                <option value="in">進貨（增加庫存）</option>
                <option value="out">銷貨（減少庫存）</option>
              </select>
              <button id="addTran">記錄</button>
            </div>
            <div style="color:var(--muted);font-size:0.9rem;margin-top:8px">銷貨會檢查庫存並在不足時提示。</div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h2>交易紀錄</h2>
          <div style="max-height:220px;overflow:auto;background:linear-gradient(180deg,transparent,#031022);padding:8px;border-radius:8px">
            <ul id="logList" style="margin:0;padding:0;list-style:none"></ul>
          </div>
        </div>
      </div>

      <div>
        <div class="panel">
          <div class="toolbar">
            <input id="search" placeholder="搜尋商品或備註" style="flex:1" />
            <select id="filterLow"><option value="all">顯示全部</option><option value="low">庫存低於 10</option><option value="out">已售罄</option></select>
          </div>

          <div style="overflow:auto;max-height:560px">
            <table id="prodTable">
              <thead><tr><th>ID</th><th>名稱</th><th>單價</th><th>庫存</th><th>備註</th><th>操作</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="metrics">
            <div class="metric">總商品數：<span id="mCount">0</span></div>
            <div class="metric">總庫存量：<span id="mStock">0</span></div>
            <div class="metric">庫存價值：NT$<span id="mValue">0</span></div>
          </div>
        </div>
      </div>
    </div>

    <footer>提示：此範例以 localStorage 儲存資料，適合用於學校專題或練習，未連接後端。可要求我改成後端串接版。</footer>
  </div>

  <script>
    // 進銷存簡易範例（使用 localStorage 保存）
    const LS_KEY = 'fruit_inventory_v1';
    let state = { products: [], logs: [] };

    // Helpers
    const $ = id => document.getElementById(id);
    function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,6); }
    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
    function load(){ const s = localStorage.getItem(LS_KEY); if(s) state = JSON.parse(s); }
    function formatMoney(n){ return Number(n).toLocaleString(); }

    // DOM refs
    const pName = $('pName'), pPrice = $('pPrice'), pStock = $('pStock'), pNote = $('pNote'), pId = $('pId');
    const saveProduct = $('saveProduct'), clearForm = $('clearForm'), seedDemo = $('seedDemo');
    const prodTable = document.querySelector('#prodTable tbody');
    const tranProduct = $('tranProduct'), tranQty = $('tranQty'), tranType = $('tranType'), addTran = $('addTran');
    const logList = $('logList');
    const mCount = $('mCount'), mStock = $('mStock'), mValue = $('mValue');
    const search = $('search'), filterLow = $('filterLow');
    const exportBtn = $('exportBtn'), importBtn = $('importBtn'), fileInput = $('fileInput');

    // 初始化
    load(); renderAll();

    // 範例資料
    seedDemo.addEventListener('click', ()=>{
      state.products = [
        {id:uid(), name:'台灣青蘋果', price:65, stock:30, note:'箱(10顆)'} ,
        {id:uid(), name:'甜香香蕉', price:45, stock:50, note:'公斤'} ,
        {id:uid(), name:'多汁橙子', price:80, stock:12, note:'盒'} ,
        {id:uid(), name:'櫻桃 (小盒)', price:150, stock:4, note:'盒'} ,
        {id:uid(), name:'芒果（夏季）', price:120, stock:0, note:'公斤'}
      ];
      state.logs = [];
      save(); renderAll();
    });

    // 儲存商品
    saveProduct.addEventListener('click', ()=>{
      const name = pName.value.trim(); const price = Number(pPrice.value||0); const stock = Number(pStock.value||0); const note = pNote.value.trim();
      if(!name){ alert('請填寫商品名稱'); return; }
      if(pId.value){ // 編輯
        const prod = state.products.find(x=>x.id===pId.value);
        prod.name = name; prod.price = price; prod.stock = stock; prod.note = note;
        addLog('edit', prod.id, `${prod.name} 資料編輯`);
      } else {
        const prod = {id:uid(), name, price, stock, note};
        state.products.push(prod);
        addLog('create', prod.id, `新增商品：${prod.name}（庫存 ${prod.stock}）`);
      }
      clearFormFn(); save(); renderAll();
    });

    clearForm.addEventListener('click', clearFormFn);
    function clearFormFn(){ pId.value=''; pName.value=''; pPrice.value=100; pStock.value=0; pNote.value=''; }

    // 新增交易 (進/出)
    addTran.addEventListener('click', ()=>{
      const pid = tranProduct.value; const qty = Number(tranQty.value||0); const type = tranType.value;
      if(!pid){ alert('請選擇商品'); return; }
      if(qty <= 0){ alert('請輸入數量'); return; }
      const prod = state.products.find(p=>p.id===pid);
      if(!prod) return;
      if(type==='out'){
        if(prod.stock < qty){ if(!confirm('庫存不足，是否仍要強制減少？')) return; }
        prod.stock = Math.max(0, prod.stock - qty);
        addLog('out', pid, `銷貨 ${prod.name} × ${qty}`);
      } else {
        prod.stock += qty;
        addLog('in', pid, `進貨 ${prod.name} × ${qty}`);
      }
      save(); renderAll();
    });

    // add log
    function addLog(type, pid, note){ state.logs.unshift({id:uid(), time:new Date().toISOString(), type, pid, note}); if(state.logs.length>200) state.logs.pop(); }

    // render 所有
    function renderAll(){ renderProductTable(); renderTranSelect(); renderLogs(); renderMetrics(); }

    function renderProductTable(){
      const q = (search.value||'').toLowerCase(); const filter = filterLow.value;
      prodTable.innerHTML = '';
      const list = state.products.filter(p=>{
        if(filter==='low' && p.stock>=10) return false;
        if(filter==='out' && p.stock>0) return false;
        if(q && !(p.name.toLowerCase().includes(q) || (p.note||'').toLowerCase().includes(q))) return false;
        return true;
      });
      list.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id.slice(-6)}</td>
          <td><strong>${p.name}</strong></td>
          <td>NT$${formatMoney(p.price)}</td>
          <td>${p.stock > 0 ? `<span class="${p.stock===0? 'stock-out':'stock-low'}">${p.stock}</span>` : '<span class="stock-out">0</span>'}</td>
          <td>${p.note||''}</td>
          <td>
            <button class="small-btn" data-act="edit" data-id="${p.id}">編輯</button>
            <button class="small-btn" data-act="del" data-id="${p.id}">刪除</button>
          </td>
        `;
        prodTable.appendChild(tr);
      });
      // attach events
      prodTable.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const act = btn.dataset.act; const id = btn.dataset.id;
          if(act==='edit'){ const prod = state.products.find(x=>x.id===id); pId.value=prod.id; pName.value=prod.name; pPrice.value=prod.price; pStock.value=prod.stock; pNote.value=prod.note; window.scrollTo({top:0,behavior:'smooth'}); }
          if(act==='del'){ if(confirm('確定要刪除？')){ state.products = state.products.filter(x=>x.id!==id); addLog('delete', id, `刪除商品 (${id.slice(-6)})`); save(); renderAll(); } }
        });
      });
    }

    function renderTranSelect(){ tranProduct.innerHTML = '<option value="">-- 選擇商品 --</option>';
      state.products.forEach(p=>{ const opt = document.createElement('option'); opt.value=p.id; opt.textContent=`${p.name}（庫存 ${p.stock}）`; tranProduct.appendChild(opt); }); }

    function renderLogs(){ logList.innerHTML=''; state.logs.slice(0,200).forEach(l=>{ const li = document.createElement('li'); li.style.padding='6px 0'; li.style.borderBottom='1px solid rgba(255,255,255,0.02)'; li.innerHTML = `<div style="font-size:0.9rem">${new Date(l.time).toLocaleString()} — <span class="muted">${l.type}</span> — ${l.note}</div>`; logList.appendChild(li);} ); }

    function renderMetrics(){ mCount.textContent = state.products.length; const totalStock = state.products.reduce((s,p)=>s+p.stock,0); mStock.textContent = totalStock; const totalVal = state.products.reduce((s,p)=>s + (p.stock * p.price),0); mValue.textContent = formatMoney(totalVal); }

    // search/filter
    search.addEventListener('input', renderProductTable); filterLow.addEventListener('change', renderProductTable);

    // export CSV (商品 + 交易)
    exportBtn.addEventListener('click', ()=>{
      // products
      let csv = 'type,id,name,price,stock,note
';
      state.products.forEach(p=>{ csv += `product,${p.id},"${p.name}",${p.price},${p.stock},"${(p.note||'').replace(/"/g,'""')}"
`; });
      // logs
      csv += '
logs
';
      csv += 'time,type,pid,note
';
      state.logs.forEach(l=>{ csv += `${l.time},${l.type},${l.pid},"${(l.note||'').replace(/"/g,'""')}"
`; });
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = 'inventory_export.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // import CSV (very simple parser for our exported format)
    importBtn.addEventListener('click', ()=>fileInput.click());
    fileInput.addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return; const text = await f.text();
      // naive parse: split into sections
      if(text.includes('product') && text.includes('logs')){
        const parts = text.split('

logs
');
        const prodLines = parts[0].split('
').slice(1).filter(Boolean);
        const logLines = parts[1].split('
').slice(1).filter(Boolean);
        const products = prodLines.map(line=>{
          const cols = splitCSV(line);
          return {id:cols[1], name:cols[2].replace(/^"|"$/g,''), price:Number(cols[3]), stock:Number(cols[4]), note:cols[5].replace(/^"|"$/g,'')};
        });
        const logs = logLines.map(line=>{ const cols = splitCSV(line); return {time:cols[0], type:cols[1], pid:cols[2], note:cols[3].replace(/^"|"$/g,'')}; });
        state.products = products; state.logs = logs; save(); renderAll(); alert('匯入完成');
      } else alert('檔案格式不正確');
      fileInput.value = '';
    });

    function splitCSV(line){ // 最簡易的 CSV 分割（不完全）
      const out = []; let cur=''; let inq=false;
      for(let i=0;i<line.length;i++){ const ch=line[i]; if(ch==='"'){ inq=!inq; cur+=ch; } else if(ch===',' && !inq){ out.push(cur); cur=''; } else cur+=ch; } if(cur) out.push(cur); return out;
    }

    // 初次示範若沒有資料
    if(state.products.length===0 && state.logs.length===0){ /* keep empty until user seeds */ }
  </script>
</body>
</html>
